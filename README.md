# Weltspiegel Template

Joomla 5/6 site template for Weltspiegel Cottbus cinema.

## Description

Custom template with modern build tooling for the Weltspiegel Cottbus cinema website. Built with Vite for optimal performance and developer experience.

## Requirements

- Joomla 5.0 or higher (tested with Joomla 6)
- PHP 8.1 or higher

## Installation

### Manual Installation

1. Build the package:
   ```bash
   npm install
   npm run release
   ```

2. Upload the generated ZIP file via Joomla Administrator:
   - System → Templates → Install
   - Upload `tpl_weltspiegel-*.zip`

3. Set as default template:
   - System → Site Templates → Weltspiegel → Make Default

### Via GitHub Releases

Download the latest release ZIP from the GitHub releases page and install via Joomla Administrator.

### Automatic Updates

Once installed, the template can be updated automatically through Joomla's update system:
- System → Update → Extensions
- Joomla checks the update server configured in the template manifest
- New versions are automatically detected and can be installed with one click

The update manifest is hosted at:
`https://raw.githubusercontent.com/weltspiegel-cottbus/tpl_weltspiegel/main/update-manifest.xml`

## Development

### Build Process

The template uses Vite for building and minifying assets:

```bash
# Install dependencies
npm install

# Build assets
npm run build

# Create Joomla installation package
npm run package

# Build and package in one command
npm run release
```

### Project Structure

```
tpl_weltspiegel/
├── index.php                    # Main template file
├── templateDetails.xml          # Joomla manifest
├── joomla.asset.json           # Web Asset Manager config
├── vite.config.js              # Vite build configuration
├── language/                    # Translation files
│   └── de-DE/
│       ├── tpl_weltspiegel.ini
│       └── tpl_weltspiegel.sys.ini
└── media/                       # Template assets
    ├── css/
    │   ├── template.css        # Source CSS
    │   └── template.min.css    # Built CSS (generated)
    └── js/
        ├── template.js         # Source JS (ES modules)
        └── template.min.js     # Built JS (generated)
```

### Asset Development

**Source files** are in `media/css/` and `media/js/`:
- `media/js/template.js` - Main JavaScript entry point (imports CSS too)
- `media/css/template.css` - Main stylesheet

**Built files** are generated by Vite:
- `media/js/template.min.js` - Minified ES module
- `media/css/template.min.css` - Minified CSS

**Workflow:**
1. Edit source files in `media/js/` and `media/css/`
2. Run `npm run build` to generate minified files
3. Built files are loaded by Joomla (configured in `joomla.asset.json`)

**Import CSS in JavaScript:**
```javascript
// In template.js
import '../css/template.css';
```

**Import additional modules:**
```javascript
// In template.js
import './navigation.js';
import './utils.js';
```

**CSS imports:**
```css
/* In template.css */
@import './base.css';
@import './layout.css';
```

### Creating Releases

This project uses [changelogen](https://github.com/unjs/changelogen) for automated changelog generation and releases based on conventional commits.

#### Commit Message Format

Follow conventional commits format:

```
<type>: <description>

[optional body]
```

**Types:**
- `feat:` New feature (bumps minor version)
- `fix:` Bug fix (bumps patch version)
- `perf:` Performance improvement (bumps patch version)
- `refactor:` Code refactoring (bumps patch version)
- `docs:` Documentation changes
- `build:` Build system changes
- `chore:` Maintenance tasks
- `ci:` CI/CD changes
- `style:` Code style changes
- `test:` Test changes

**Examples:**
```bash
git commit -m "feat: add responsive navigation"
git commit -m "fix: correct mobile layout issue"
git commit -m "docs: update installation instructions"
```

#### Release Commands

Install dependencies first:
```bash
npm install
```

**Before releasing**, update version numbers in three files:

1. **`templateDetails.xml`**:
   - Update the `<version>` tag to match the new version

2. **`joomla.asset.json`**:
   - Update the `version` field to match the new version

3. **`update-manifest.xml`**:
   - Update the `<version>` tag to match the new version
   - Update the download URL to match the new version tag and filename

4. Commit these changes

**Note:** Do NOT manually update `package.json` - changelogen will automatically bump the version there.

Then create a release:

```bash
# Patch release (0.0.1 -> 0.0.2) - for bug fixes
npm run release:patch

# Minor release (0.0.1 -> 0.1.0) - for new features
npm run release:minor

# Major release (0.0.1 -> 1.0.0) - for breaking changes
npm run release:major
```

This will:
1. Generate/update `CHANGELOG.md`
2. Bump version in `package.json`
3. Create a git commit with the changes
4. Create a git tag (e.g., `v0.1.0`)
5. Push to GitHub
6. Create a GitHub release with changelog
7. Trigger GitHub Actions to build and attach the ZIP file

#### Manual Changelog Generation

To generate changelog without releasing:

```bash
npm run changelog
```

### What Gets Packaged

The build script includes necessary files for Joomla installation:
- `index.php` - Template file
- `templateDetails.xml` - Manifest
- `joomla.asset.json` - Asset configuration
- `LICENSE` - License file
- `language/` - Translation files
- `media/` - Both source and built assets (CSS/JS)

Excluded from package:
- `.idea/` - IDE files
- `.git/`, `.github/` - Git repository and workflows
- `.build/` - Build scripts
- `node_modules/` - Dependencies
- `package.json`, `package-lock.json` - npm files
- `vite.config.js` - Build configuration
- `update-manifest.xml` - Update manifest (hosted separately)
- `CHANGELOG.md`, `README.md` - Documentation
- `*.zip` - Previous builds

## Continuous Integration

### GitHub Actions

The template includes a GitHub Actions workflow (`.github/workflows/release.yml`) that automatically builds and attaches the ZIP file to releases.

#### How It Works

When you run `npm run release:minor` (or patch/major):
1. **Changelogen** creates the GitHub release with changelog
2. **GitHub Actions** triggers automatically on release creation
3. **Workflow** builds assets and packages the ZIP, then attaches it to the release

The workflow:
1. Checks out the code
2. Sets up Node.js LTS with npm caching
3. Installs dependencies with `npm ci`
4. Builds the minified assets with Vite
5. Creates the installable ZIP package
6. Uploads the ZIP to the release created by changelogen

No manual intervention needed - just run the release command!

## Features

- **Modern Build System**: Vite 7 for fast builds and optimal output
- **ES Modules**: JavaScript compiled as ES modules for modern browsers
- **Minimal Base**: Bare-metal template ready for customization
- **Automatic Updates**: Self-updating via Joomla's update system
- **Developer Friendly**: Fast rebuilds with Vite

## License

MIT License - see LICENSE file for details

## Credits

Developed for Weltspiegel Cottbus cinema
